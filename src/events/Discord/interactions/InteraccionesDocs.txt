AquÃ­ tienes la documentaciÃ³n completa para gestionar **todas las interacciones** en tu bot de Discord, integrando el sistema de botones con otros componentes:

---

## **ğŸ› ï¸ Sistema Unificado de Interacciones**
### **Estructura Recomendada**
```
src/
â”œâ”€â”€ interactions/
â”‚   â”œâ”€â”€ buttons/          # Botones (ya cubierto)
â”‚   â”œâ”€â”€ modals/           # Formularios modales
â”‚   â”œâ”€â”€ selectMenus/      # MenÃºs desplegables
â”‚   â”œâ”€â”€ contextMenus/     # MenÃºs contextuales (click derecho)
â”‚   â”œâ”€â”€ autocomplete/     # Autocompletado de opciones
â”‚   â””â”€â”€ index.js          # Cargador principal
â””â”€â”€ utils/
    â”œâ”€â”€ interactionUtils.js # Funciones compartidas
    â”œâ”€â”€ contextManager.js   # GestiÃ³n de estado
```

---

## **ğŸ“œ 1. MenÃºs de SelecciÃ³n (Select Menus)**
### **Plantilla BÃ¡sica** (`/interactions/selectMenus/roles.js`)
```javascript
module.exports = {
    customId: 'select-roles', // ID Ãºnico
    permissions: ['ManageRoles'],

    async execute(interaction) {
        const selectedRoleId = interaction.values[0];

        // 1. Validar rol
        if (!interaction.guild.roles.cache.has(selectedRoleId)) {
            return interaction.reply({
                content: 'âŒ Rol no encontrado',
                ephemeral: true
            });
        }

        // 2. Asignar rol
        await interaction.member.roles.add(selectedRoleId);

        // 3. Responder
        await interaction.update({
            content: `âœ… Rol asignado: <@&${selectedRoleId}>`,
            components: []
        });
    }
};
```

### **CÃ³mo registrarlo**:
```javascript
// En tu comando o handler principal:
const selectMenu = new StringSelectMenuBuilder()
    .setCustomId('select-roles')
    .setPlaceholder('Selecciona un rol')
    .addOptions(
        roles.map(role => ({
            label: role.name,
            value: role.id
        }))
);

await interaction.reply({
    components: [new ActionRowBuilder().addComponents(selectMenu)]
});
```

---

## **ğŸ“‹ 2. Formularios Modales**
### **Ejemplo: Formulario de Reporte** (`/interactions/modals/reporte.js`)
```javascript
module.exports = {
    customId: 'modal-reporte',
    fields: ['titulo', 'descripcion'], // Campos esperados

    async execute(interaction) {
        const titulo = interaction.fields.getTextInputValue('titulo');
        const descripcion = interaction.fields.getTextInputValue('descripcion');

        // Guardar en DB o enviar a un canal
        await interaction.reply({
            content: `ğŸ“ Reporte enviado: **${titulo}**`,
            ephemeral: true
        });
    }
};
```

### **Uso con Botones**:
```javascript
// 1. BotÃ³n que abre el modal
const button = new ButtonBuilder()
    .setCustomId('abrir-modal-reporte')
    .setLabel('Reportar Bug')
    .setStyle(ButtonStyle.Danger);

// 2. Handler del botÃ³n
module.exports = {
    customId: 'abrir-modal-reporte',
    async execute(interaction) {
        const modal = new ModalBuilder()
            .setCustomId('modal-reporte')
            .setTitle('Reporte de Bug')
            .addComponents(
                new ActionRowBuilder().addComponents(
                    new TextInputBuilder()
                        .setCustomId('titulo')
                        .setLabel('TÃ­tulo')
                        .setStyle(TextInputStyle.Short)
                ),
                new ActionRowBuilder().addComponents(
                    new TextInputBuilder()
                        .setCustomId('descripcion')
                        .setLabel('DescripciÃ³n')
                        .setStyle(TextInputStyle.Paragraph)
                )
            );

        await interaction.showModal(modal);
    }
};
```

---

## **ğŸ–±ï¸ 3. MenÃºs Contextuales**
### **Ejemplo: Obtener Info de Usuario** (`/interactions/contextMenus/userInfo.js`)
```javascript
module.exports = {
    name: 'Obtener Info', // Nombre visible en el menÃº
    type: ApplicationCommandType.User, // Tipo: User/Message

    async execute(interaction) {
        const user = interaction.targetUser;

        await interaction.reply({
            embeds: [
                new EmbedBuilder()
                    .setTitle(`InformaciÃ³n de ${user.username}`)
                    .addFields(
                        { name: 'ID', value: user.id },
                        { name: 'Cuenta creada', value: user.createdAt.toLocaleDateString() }
                    )
            ],
            ephemeral: true
        });
    }
};
```

---

## **ğŸ” 4. Autocompletado**
### **Ejemplo: BÃºsqueda de Comandos** (`/interactions/autocomplete/commands.js`)
```javascript
module.exports = {
    commandName: 'ayuda', // Nombre del comando asociado
    optionName: 'comando', // Nombre de la opciÃ³n a autocompletar

    async execute(interaction) {
        const focusedValue = interaction.options.getFocused().toLowerCase();
        const commands = client.commands.filter(cmd =>
            cmd.name.includes(focusedValue)
            .map(cmd => ({
                name: cmd.name,
                value: cmd.name
            }))
            .slice(0, 25); // LÃ­mite de Discord

        await interaction.respond(commands);
    }
};
```

---

## **ğŸ”„ 5. IntegraciÃ³n con Botones**
### **Flujo Combinado: BotÃ³n â†’ Modal â†’ Select Menu**
1. **BotÃ³n inicial** (`/buttons/iniciar-flujo.js`):
   ```javascript
   module.exports = {
       customId: 'iniciar-flujo',
       async execute(interaction) {
           await interaction.showModal(/* ... */);
       }
   };
   ```

2. **Modal** (`/modals/formulario.js`):
   ```javascript
   module.exports = {
       customId: 'formulario',
       async execute(interaction) {
           const data = interaction.fields.getTextInputValue('dato');
           await interaction.reply({
               content: 'Selecciona una opciÃ³n:',
               components: [/* Select Menu */]
           });
       }
   };
   ```

3. **Select Menu** (`/selectMenus/opciones.js`):
   ```javascript
   module.exports = {
       customId: 'opciones',
       async execute(interaction) {
           await interaction.update({
               content: 'âœ… Flujo completado',
               components: []
           });
       }
   };
   ```

---

## **âš™ï¸ 6. ConfiguraciÃ³n del Cargador Principal**
### (`/interactions/index.js`)
```javascript
const { loadButtons, loadModals, loadSelectMenus } = require('./loaders');

module.exports = async (client) => {
    await Promise.all([
        loadButtons(client),
        loadModals(client),
        loadSelectMenus(client),
        // ...otros loaders
    ]);
};
```

---

## **ğŸ“Œ 7. Buenas PrÃ¡cticas para Todas las Interacciones**
1. **ValidaciÃ³n de Usuario**:
   ```javascript
   if (interaction.user.id !== expectedUserId) {
       return interaction.reply({ content: 'âŒ No autorizado', ephemeral: true });
   }
   ```

2. **GestiÃ³n de Estado**:
   Usa `contextManager.set()` para persistir datos entre pasos.

3. **Limpieza AutomÃ¡tica**:
   Programa `contextManager.cleanup()` para borrar datos antiguos.

4. **Respuestas Ephemeral**:
   Usa `ephemeral: true` para interacciones sensibles.

---

## **ğŸ¨ 8. Ejemplo Avanzado: Sistema de Tickets Completo**
Combina mÃºltiples interacciones:
1. **BotÃ³n** "Crear Ticket" â†’ Abre **Modal** con detalles.
2. **Modal** envÃ­a datos â†’ Muestra **Select Menu** para categorÃ­a.
3. **Select Menu** cierra el flujo y notifica al staff.

```mermaid
sequenceDiagram
    Usuario->>Bot: Click en "Crear Ticket" (BotÃ³n)
    Bot->>Usuario: Muestra Modal
    Usuario->>Bot: EnvÃ­a Formulario (Modal)
    Bot->>Usuario: Pide CategorÃ­a (Select Menu)
    Usuario->>Bot: Selecciona OpciÃ³n
    Bot->>Canal-Staff: Notifica Ticket Nuevo
```

---

## **ğŸš¨ 9. SoluciÃ³n de Problemas Comunes**
| Error                          | Causa                     | SoluciÃ³n                          |
|--------------------------------|---------------------------|-----------------------------------|
| "Interaction Failed"           | Handler no registrado     | Verificar carga en `/interactions/index.js` |
| "Invalid Form Body"            | Custom ID duplicado       | Usar IDs Ãºnicos por tipo          |
| "Missing Permissions"          | Falta `ephemeral`         | AÃ±adir `ephemeral: true` si es necesario |

---

Con este sistema, tendrÃ¡s un **control completo** sobre todas las interacciones de Discord, manteniendo consistencia y escalabilidad. Â¿Necesitas ejemplos adicionales para algÃºn tipo especÃ­fico de interacciÃ³n?

# **GuÃ­a Definitiva: Sistema de Botones e Interacciones Avanzado**

---

## **ğŸ“Œ 1. IntroducciÃ³n**
Este sistema unificado permite:
- **Botones dinÃ¡micos** que se adaptan al contexto.
- **GestiÃ³n de estado** entre interacciones.
- **ReutilizaciÃ³n mÃ¡xima** mediante plantillas.
- **Escalabilidad** para bots complejos.

---

## **ğŸš€ 2. MigraciÃ³n desde el Sistema Anterior**

### **Pasos Clave:**
1. **Reorganiza tus botones** en la nueva estructura de carpetas:
   ```
   /interactions/buttons/
   â”œâ”€â”€ templates/      # Plantillas reutilizables
   â”œâ”€â”€ comandos/       # Botones de comandos especÃ­ficos
   â””â”€â”€ moderacion/     # Botones de moderaciÃ³n
   ```

2. **Actualiza los Custom IDs** al formato:
   ```plaintext
   [prefijo]_[acciÃ³n]_[commandId]_[userId]_[metadata]
   ```
   Ejemplo: `mod_ban_cmd123_usr456_guild789`

3. **Refactoriza los handlers** para usar:
   - `contextManager` para persistir datos.
   - Plantillas estÃ¡ndar (`paginacion`, `confirmacion`, etc.).

---

## **ğŸ› ï¸ 3. CreaciÃ³n de Nuevos Botones**

### **A. Plantilla BÃ¡sica** (`/interactions/buttons/comandos/ejemplo.js`)
```javascript
const { getCommandContext } = require('../../../utils/contextManager');

module.exports = {
    customId: 'ejemplo_', // Prefijo Ãºnico
    permissions: ['ViewChannel'], // Permisos requeridos
    ownerOnly: true, // Solo el creador puede interactuar

    async execute(interaction, client) {
        const [_, action, commandId, userId] = interaction.customId.split('_');

        // 1. Validar usuario
        if (userId !== interaction.user.id) {
            return interaction.reply({
                content: 'âŒ Acceso denegado',
                ephemeral: true
            });
        }

        // 2. Obtener contexto del comando original
        const context = getCommandContext(commandId);

        // 3. LÃ³gica personalizada
        const response = await this._handleAction(action, context);

        // 4. Responder
        await interaction.update(response);
    },

    async _handleAction(action, context) {
        switch(action) {
            case 'edit':
                return {
                    content: `Editando: ${context.target}`,
                    components: []
                };
            default:
                return { content: 'AcciÃ³n no vÃ¡lida', components: [] };
        }
    }
};
```

### **B. Registro en el Cargador Principal** (`/interactions/index.js`)
```javascript
const { loadButtons } = require('./buttons');

module.exports = async (client) => {
    await loadButtons(client); // Carga todos los handlers
};
```

---

## **ğŸ”— 4. Uso con Comandos Existentes**

### **Ejemplo: Comando `/config` con Botones**
```javascript
const { contextManager } = require('../../utils/contextManager');
const { createConfigButtons } = require('../../templates/config');

module.exports = {
    name: 'config',
    async execute(interaction) {
        const commandId = `config-${interaction.id}`;

        // Guardar contexto
        contextManager.set(commandId, {
            guild: interaction.guildId,
            currentTab: 'general'
        });

        // Responder con botones dinÃ¡micos
        await interaction.reply({
            content: 'Panel de ConfiguraciÃ³n',
            components: createConfigButtons(commandId, interaction.user.id)
        });
    }
};
```

---

## **ğŸ¨ 5. Plantillas Predefinidas**

### **A. PaginaciÃ³n** (`/templates/paginacion.js`)
```javascript
function createPagination(commandId, userId, currentPage, totalPages) {
    return [
        new ActionRowBuilder().addComponents(
            new ButtonBuilder()
                .setCustomId(`page_prev_${commandId}_${userId}`)
                .setLabel('â—€')
                .setStyle(ButtonStyle.Primary)
                .setDisabled(currentPage <= 0),
            new ButtonBuilder()
                .setCustomId(`page_next_${commandId}_${userId}`)
                .setLabel('â–¶')
                .setStyle(ButtonStyle.Primary)
                .setDisabled(currentPage >= totalPages - 1)
        )
    ];
}
```

### **B. ConfirmaciÃ³n** (`/templates/confirmacion.js`)
```javascript
function createConfirmation(commandId, userId, question = 'Â¿Confirmas?') {
    return {
        content: question,
        components: [
            new ActionRowBuilder().addComponents(
                new ButtonBuilder()
                    .setCustomId(`conf_yes_${commandId}_${userId}`)
                    .setLabel('âœ… SÃ­')
                    .setStyle(ButtonStyle.Success),
                new ButtonBuilder()
                    .setCustomId(`conf_no_${commandId}_${userId}`)
                    .setLabel('âŒ No')
                    .setStyle(ButtonStyle.Danger)
            )
        ]
    };
}
```

---

## **âš¡ 6. Mejores PrÃ¡cticas**

### **Para MigraciÃ³n:**
1. **Empieza con comandos simples**: Migra primero `/help` o `/info`.
2. **Usa wrappers**: Crea funciones que conviertan tus botones antiguos al nuevo formato:
   ```javascript
   function convertOldButton(oldId) {
       const [action, userId] = oldId.split('-');
       return `legacy_${action}_migrated_${userId}`;
   }
   ```

### **Para Nuevos Proyectos:**
1. **Prefijos claros**: Usa `mod_`, `util_`, `game_` para categorizar.
2. **Documenta tus Custom IDs**: MantÃ©n un registro en `/docs/button-ids.md`.
3. **Limpia cachÃ© automÃ¡ticamente**:
   ```javascript
   setInterval(() => contextManager.cleanup(), 3600000); // Cada hora
   ```

---

## **ğŸš¨ 7. SoluciÃ³n de Problemas Comunes**

| Error                          | Causa                     | SoluciÃ³n                          |
|--------------------------------|---------------------------|-----------------------------------|
| "Unknown Interaction"          | BotÃ³n usado despuÃ©s de 15min | Usar `interaction.deferUpdate()` |
| "Invalid Custom ID"            | Formato incorrecto        | Verificar `[prefijo]_[acciÃ³n]_[commandId]_[userId]` |
| "Missing Context"              | No se guardÃ³ el contexto  | Asegurar `contextManager.set()` |

---

## **ğŸ“ˆ 8. Ventajas Clave**

âœ… **Flexibilidad**: Botones se comportan segÃºn el comando que los generÃ³.
âœ… **Estado persistente**: Mantiene datos entre interacciones.
âœ… **CÃ³digo limpio**: Separa lÃ³gica en plantillas reutilizables.
âœ… **Escalable**: FÃ¡cil de extender para nuevos tipos de interacciones.

---

## **ğŸ”® 9. Ejemplo Avanzado: Sistema de Tickets**
```javascript
// 1. Comando /ticket create
const commandId = `ticket-${interaction.user.id}`;
contextManager.set(commandId, {
    category: 'support',
    user: interaction.user.id
});

// 2. Botones generados
await interaction.reply({
    content: 'Opciones de Ticket:',
    components: [
        new ActionRowBuilder().addComponents(
            new ButtonBuilder()
                .setCustomId(`ticket_open_${commandId}_${interaction.user.id}`)
                .setLabel('Abrir Ticket')
                .setStyle(ButtonStyle.Success),
            new ButtonBuilder()
                .setCustomId(`ticket_close_${commandId}_${interaction.user.id}`)
                .setLabel('Cerrar')
                .setStyle(ButtonStyle.Danger)
        )
    ]
});
```

---

Con este sistema, tendrÃ¡s un flujo de trabajo **robusto, mantenible y escalable** para todas las interacciones de tu bot. Â¿Necesitas ejemplos adicionales para casos de uso especÃ­ficos?
